services:
    backend:
        build:
            context: ./backend
            args:
                - BACKEND_PORT=${BACKEND_PORT}
                - MLFLOW_TRACKING_URI=${MLFLOW_TRACKING_URI}
                - MODEL_URI_PROD=${MODEL_URI_PROD}
                - MODEL_URI_DEV=${MODEL_URI_DEV}
                - MODEL_URI_BACKUP=${MODEL_URI_BACKUP}

                - WEAKLINK_MODEL_URI_PROD=${WEAKLINK_MODEL_URI_PROD}
                - WEAKLINK_MODEL_URI_DEV=${WEAKLINK_MODEL_URI_DEV}
                - WEAKLINK_MODEL_URI_BACKUP=${WEAKLINK_MODEL_URI_BACKUP}
        container_name: 4dt907-backend
        environment:
            - BACKEND_PORT=${BACKEND_PORT}
            - MLFLOW_TRACKING_URI=${MLFLOW_TRACKING_URI}
            - MODEL_URI_PROD=${MODEL_URI_PROD}
            - MODEL_URI_DEV=${MODEL_URI_DEV}
            - MODEL_URI_BACKUP=${MODEL_URI_BACKUP}
        volumes:
            - ./backend:/backend_app
            - /opt/.venv
        restart: unless-stopped
        networks:
            - app-network

    frontend:
        build:
            context: ./frontend
            args:
                - BACKEND_PORT=${BACKEND_PORT}
                - BACKEND_URL=${BACKEND_URL}
                - FRONTEND_PORT=${FRONTEND_PORT}
        container_name: 4dt907-frontend
        environment:
            - BACKEND_PORT=${BACKEND_PORT}
            - BACKEND_URL=${BACKEND_URL}
            - FRONTEND_PORT=${FRONTEND_PORT}
        ports:
            - "${FRONTEND_PORT}:${FRONTEND_PORT}"
        volumes:
            - ./frontend:/frontend_app
            - /frontend_app/node_modules
        depends_on:
            - backend
        restart: unless-stopped
        networks:
            - app-network

networks:
    app-network:
        driver: bridge
